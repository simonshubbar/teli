<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>{% block title %}Teli{% endblock %}</title>

    <!-- Our custom iOS-style design system — no external CSS framework needed -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

    <!-- PWA manifest -->
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    <meta name="theme-color" content="#000000" media="(prefers-color-scheme: dark)">
    <meta name="theme-color" content="#F2F2F7" media="(prefers-color-scheme: light)">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
</head>

<body data-page="{% block page %}home{% endblock %}">

    <!-- Navigation bar -->
    <header class="nav-bar">
        <div class="nav-bar-inner">
            <!-- Left: Import icon (only when logged in) -->
            {% block nav_left %}
                {% if current_user.is_authenticated %}
                <a href="{{ url_for('import_page') }}" class="nav-import" title="Import">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="3" width="18" height="18" rx="3"/>
                        <line x1="12" y1="8" x2="12" y2="16"/>
                        <line x1="8" y1="12" x2="16" y2="12"/>
                    </svg>
                </a>
                {% endif %}
            {% endblock %}

            <h1 class="nav-title">{% block nav_title %}Teli{% endblock %}</h1>

            <!-- Right: Profile avatar with dropdown menu -->
            {% block nav_right %}
                {% if current_user.is_authenticated %}
                <div class="nav-profile">
                    <!-- Clickable avatar that toggles the dropdown -->
                    <button class="profile-toggle" id="profileToggle" aria-label="Profile menu">
                        {% if current_user.picture %}
                            <img src="{{ current_user.picture }}" alt="{{ current_user.name }}" class="nav-avatar" referrerpolicy="no-referrer">
                        {% else %}
                            <!-- Fallback: first letter of name -->
                            <span class="nav-avatar-fallback">{{ current_user.name[0] if current_user.name else '?' }}</span>
                        {% endif %}
                    </button>

                    <!-- Dropdown menu (hidden by default) -->
                    <div class="profile-dropdown" id="profileDropdown">
                        <div class="profile-dropdown-header">
                            <p class="profile-name">{{ current_user.name or 'User' }}</p>
                            <p class="profile-email">{{ current_user.email or '' }}</p>
                        </div>
                        <div class="profile-dropdown-divider"></div>
                        <a href="{{ url_for('auth.logout') }}" class="profile-dropdown-item sign-out">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                                <polyline points="16 17 21 12 16 7"/>
                                <line x1="21" y1="12" x2="9" y2="12"/>
                            </svg>
                            Sign Out
                        </a>
                    </div>
                </div>
                {% endif %}
            {% endblock %}
        </div>
    </header>

    <!-- Flash messages — iOS-style inline alerts -->
    <main class="container">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="flash-message flash-{{ category }}" role="alert">
                        {{ message }}
                        <button class="flash-close" onclick="this.parentElement.remove()">&times;</button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </main>

    <!-- Floating search bar — only show when logged in -->
    {% if current_user.is_authenticated %}
    <div class="floating-search-bar">
        <div class="floating-search-form">
            <svg class="floating-search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="11" cy="11" r="8"/>
                <line x1="21" y1="21" x2="16.65" y2="16.65"/>
            </svg>
            <!-- This input is just a trigger — tapping it opens the overlay -->
            <input type="search" placeholder="Search movies & TV shows..." class="floating-search-input" id="floatingSearchTrigger" aria-label="Search" readonly>
        </div>
    </div>

    <!-- Full-screen search overlay — hidden by default, slides up when triggered -->
    <div id="searchOverlay" class="search-overlay">
        <!-- Top bar with search input and Cancel button -->
        <div class="overlay-top-bar">
            <div class="overlay-search-wrapper">
                <svg class="floating-search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="11" cy="11" r="8"/>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                </svg>
                <input type="search" placeholder="Search movies & TV shows..." class="overlay-search-input" id="overlaySearchInput" aria-label="Search">
            </div>
            <button class="overlay-cancel-btn" id="overlayCancel">Cancel</button>
        </div>

        <!-- Scrollable results area -->
        <div class="overlay-results" id="overlayResults">
            <p class="overlay-hint">Type to search for movies and TV shows</p>
        </div>
    </div>
    {% endif %}

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
